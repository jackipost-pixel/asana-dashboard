<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Asana Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(120deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    .setup-panel {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 2px 12px rgba(102,126,234,0.12);
      margin-bottom: 20px;
    }
    .setup-panel.hidden {
      display: none;
    }
    .input-group {
      margin-bottom: 20px;
    }
    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
    }
    .input-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e8e8e8;
      border-radius: 8px;
      font-size: 16px;
    }
    .input-group input:focus {
      outline: none;
      border-color: #667eea;
    }
    .btn {
      background: linear-gradient(120deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 28px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .btn:hover {
      transform: translateY(-2px) scale(1.04);
    }
    .dashboard {
      display: none;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
    }
    .card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 2px 12px rgba(102,126,234,0.12);
      transition: transform 0.3s;
    }
    .card:hover {
      transform: translateY(-2px) scale(1.03);
    }
    .card h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 1.3em;
    }
    .task-item {
      padding: 10px 20px;
      margin: 10px 0;
      background: #f8f9ff;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .task-name {
      font-weight: bold;
      color: #333;
    }
    .task-project {
      font-size: 0.9em;
      color: #666;
      margin-top: 5px;
    }
    .loading {
      text-align: center;
      color: #666;
      font-style: italic;
    }
    .error {
      color: #e74c3c;
      background: #ffeaea;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: linear-gradient(120deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    .stat-number {
      font-size: 2em;
      font-weight: bold;
    }
    .stat-label {
      font-size: 0.9em;
      opacity: 0.9;
    }
    .setup-help {
      background: #e8f4fd;
      border: 1px solid #b3e0ff;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .setup-help h4 {
      color: #0c5460;
      margin-bottom: 10px;
    }
    .setup-help p {
      color: #0c5460;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ My Asana Dashboard</h1>
      <p>Track your tasks and projects in style</p>
    </div>
    <!-- Setup Panel -->
    <div class="setup-panel" id="setupPanel">
      <h2>üîß Dashboard Setup</h2>
      <p>Enter your Asana Personal Access Token to get started:</p>
      <div class="setup-help">
        <h4>How to get your Asana token:</h4>
        <p>1. Go to <a href="https://app.asana.com/0/developer-console" target="_blank">Asana Developer Console</a></p>
        <p>2. Click "Create New App"</p>
        <p>3. Fill in any app name and URL</p>
        <p>4. Go to "Personal Access Token" section</p>
        <p>5. Click "Create New Personal Access Token"</p>
        <p>6. Copy the token and paste it below</p>
      </div>
      <div class="input-group">
        <label for="asanaTokenInput">Asana Personal Access Token:</label>
        <input type="text" id="asanaTokenInput" placeholder="Paste your token here" autocomplete="off">
      </div>
      <button class="btn" onclick="connectAsana()">Connect</button>
    </div>
    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
      <div class="card">
        <h3>üìä Quick Stats</h3>
        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="totalTasks">0</div>
            <div class="stat-label">Total Tasks</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="completedTasks">0</div>
            <div class="stat-label">Completed Tasks</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="activeProjects">0</div>
            <div class="stat-label">Active Projects</div>
          </div>
        </div>
      </div>
      <div class="card">
        <h3>üìã My Tasks</h3>
        <div id="tasksContainer">
          <div class="loading">Loading tasks...</div>
        </div>
      </div>
      <div class="card">
        <h3>üìÅ Recent Projects</h3>
        <div id="projectsContainer">
          <div class="loading">Loading projects...</div>
        </div>
      </div>
    </div>
  </div>
  <script>
    let asanaToken = "";

    async function connectAsana() {
      const token = document.getElementById('asanaTokenInput').value.trim();
      if (!token) {
        alert('Please enter your Asana Personal Access Token');
        return;
      }
      asanaToken = token;
      try {
        // Test the token by getting user info
        const response = await fetch('https://app.asana.com/api/1.0/users/me', {
          headers: {
            'Authorization': `Bearer ${asanaToken}`
          }
        });
        if (!response.ok) {
          throw new Error('Invalid token or unable to connect');
        }
        // Hide setup panel and show dashboard
        document.getElementById("setupPanel").classList.add("hidden");
        document.getElementById("dashboard").style.display = "grid";
        // Load dashboard data
        loadDashboardData();
      } catch (error) {
        alert('Failed to connect to Asana. Please check your token.');
        console.error(error);
      }
    }

    async function loadDashboardData() {
      try {
        // Load tasks and projects in parallel
        const [tasksResponse, projectsResponse] = await Promise.all([
          fetch('https://app.asana.com/api/1.0/tasks?assignee=me&completed_since=now&opt_fields=name,completed,projects', {
            headers: { 'Authorization': `Bearer ${asanaToken}` }
          }),
          fetch('https://app.asana.com/api/1.0/projects?opt_fields=name,created_at', {
            headers: { 'Authorization': `Bearer ${asanaToken}` }
          })
        ]);
        const tasksData = await tasksResponse.json();
        const projectsData = await projectsResponse.json();

        displayStats(tasksData.data, projectsData.data);
        displayTasks(tasksData.data);
        displayProjects(projectsData.data);
      } catch (error) {
        console.error(error);
        document.getElementById('tasksContainer').innerHTML = '<div class="error">Failed to load tasks.</div>';
        document.getElementById('projectsContainer').innerHTML = '<div class="error">Failed to load projects.</div>';
      }
    }

    function displayStats(tasks, projects) {
      const totalTasks = tasks.length;
      const completedTasks = tasks.filter(task => task.completed).length;
      const activeProjects = projects.length;
      document.getElementById('totalTasks').textContent = totalTasks;
      document.getElementById('completedTasks').textContent = completedTasks;
      document.getElementById('activeProjects').textContent = activeProjects;
    }

    function displayTasks(tasks) {
      const taskContainer = document.getElementById('tasksContainer');
      if (tasks.length === 0) {
        taskContainer.innerHTML = '<div class="loading">No tasks found.</div>';
        return;
      }
      const incompleteTasks = tasks.filter(task => !task.completed);
      taskContainer.innerHTML = incompleteTasks.map(task => `
        <div class="task-item">
          <div class="task-name">${task.name}</div>
          <div class="task-project">
            ${task.projects && task.projects.length > 0 ?
              `Project: ${task.projects[0].name}` :
              'No project assigned'}
          </div>
        </div>
      `).join('');
    }

    function displayProjects(projects) {
      const projectContainer = document.getElementById('projectsContainer');
      if (projects.length === 0) {
        projectContainer.innerHTML = '<div class="loading">No projects found.</div>';
        return;
      }
      const activeProjects = projects
        .filter(project => !project.archived)
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
        .slice(0, 10);
      projectContainer.innerHTML = activeProjects.map(project => `
        <div class="task-item">
          <div class="task-name">üìÅ ${project.name}</div>
          <div class="task-project">
            Created: ${new Date(project.created_at).toLocaleDateString()}
          </div>
        </div>
      `).join('');
    }

    // Allow Enter key to connect
    document.getElementById('asanaTokenInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        connectAsana();
      }
    });
  </script>
</body>
</html>
